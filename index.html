<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bflix Peticiones</title>

<style>
    body{
        background:#111;
        color:#fff;
        font-family:Arial;
        margin:0; padding:0;
        text-align:center;
    }

    h1{margin-top:30px;}

    .btn{
        background:#e50914;
        border:none;
        padding:10px 20px;
        color:white;
        font-size:16px;
        cursor:pointer;
        margin:5px;
        border-radius:6px;
    }

    #peticionesBox{
        width:90%;
        max-width:600px;
        margin:20px auto;
        background:#1c1c1c;
        padding:20px;
        border-radius:10px;
        display:none;
    }

    .item{
        background:#222;
        padding:10px;
        margin:10px 0;
        border-radius:6px;
        display:flex;
        justify-content:space-between;
        align-items:center;
    }

    input{
        width:90%;
        padding:10px;
        margin:10px 0;
        border-radius:6px;
        border:none;
        outline:none;
    }

    #adminPanel button{
        background:#03c203;
        margin-left:10px;
    }
</style>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyCkIbgaE-3JuVH0sq5TqGX_RMquI_9WWI4",
authDomain: "bflix-ac765.firebaseapp.com",
databaseURL: "https://bflix-ac765-default-rtdb.firebaseio.com",
projectId: "bflix-ac765",
storageBucket: "bflix-ac765.firebasestorage.app",
messagingSenderId: "452307166004",
appId: "1:452307166004:web:7427d9d40d1cabb6b47b61",
measurementId: "G-P5PMP8H7ED"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);
window.dbRef = ref(db,"solicitudes");

// LOGIN
let esAdmin = false;

window.intentarLogin = ()=>{
    let u=document.getElementById("user").value;
    let p=document.getElementById("pass").value;

    if(u==="BflixTeam" && p==="PassBflixMovian"){
        esAdmin=true;
        document.getElementById("login").style.display="none";
        document.getElementById("peticionesBox").style.display="block";
    } else{
        alert("Datos incorrectos");
    }
};

// ENVIAR SOLICITUD
window.enviarSolicitud = ()=>{
    let v=document.getElementById("nuevaPeticion").value.trim();
    if(v==="") return;

    const nueva = push(dbRef);
    set(nueva,{
        texto:v,
        estado:"ðŸš«PendienteðŸš«",
        fecha:new Date().toLocaleString()
    }).then(()=>{
        alert("âœ” Su solicitud ha sido enviada");
        document.getElementById("nuevaPeticion").value="";
    });
};

// Marcar como completado (solo admin)
window.realizado = (id)=>{
    if(!esAdmin) return;

    update(ref(db,"solicitudes/"+id),{
        estado:"ðŸŸ¢RealizadoðŸŸ¢"
    });
};

// Cargar solicitudes realtime
onValue(dbRef,(snap)=>{
    let box=document.getElementById("lista");
    box.innerHTML="";

    snap.forEach(x=>{
        let d=x.val();
        let id=x.key;

        let div=document.createElement("div");
        div.className="item";
        div.innerHTML=`
            <span>${d.texto} <br><small>${d.estado}</small></span>
            ${esAdmin?`<button onclick="realizado('${id}')">Marcar</button>`:""}
        `;
        box.appendChild(div);
    });
});
</script>

</head>
<body>

<h1>ðŸ“Œ Peticiones</h1>

<!-- LOGIN -->
<div id="login">
    <input id="user" placeholder="Usuario">
    <input id="pass" type="password" placeholder="ContraseÃ±a">
    <button class="btn" onclick="intentarLogin()">Iniciar sesiÃ³n</button>
</div>

<!-- PANEL -->
<div id="peticionesBox">

    <h2>AÃ±adir nueva solicitud</h2>
    <input id="nuevaPeticion" placeholder="Escribe tu peticiÃ³n aquÃ­">
    <button class="btn" onclick="enviarSolicitud()">Enviar</button>

    <hr>

    <h2>Solicitudes recibidas</h2>
    <div id="lista"></div>

</div>

</body>
</html>

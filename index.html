<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Bflix</title>
<style>
    body {font-family: Arial;background:#0b0b0b;color:#fff;margin:0;padding:0;text-align:center;}
    header {background:#ff0000;padding:15px;font-size:26px;font-weight:bold;box-shadow:0 0 20px red;}
    button{padding:10px;border:none;border-radius:6px;margin:3px;font-size:15px;cursor:pointer;}
    .btn-red{background:red;color:white;font-weight:bold;}
    .btn-green{background:limegreen;color:black;font-weight:bold;}
    .btn-dark{background:#222;color:white;}
    .box{background:#111;padding:20px;margin:20px;border-radius:10px;max-width:600px;margin:auto;}
    input,select{width:80%;padding:10px;margin:5px;border-radius:6px;border:none;font-size:16px;}
    #peticionesLista div{background:#141414;padding:10px;margin:5px;border-radius:6px;font-size:18px;}
    .realizada{color:lime;font-weight:bold;}
    .pendiente{color:#ff2a2a;font-weight:bold;}
</style>
</head>
<body>

<header>ðŸ“º Bflix</header>

<button onclick="abrirPanel()" class="btn-red" style="margin-top:20px;">ðŸ“„ Peticiones</button>

<div id="panel" style="display:none;">

    <!-- LOGIN -->
    <div id="loginBox" class="box">
        <h2>Selecciona modo de acceso</h2>
        <button class="btn-green" onclick="invitado()">Entrar como Invitado</button>
        <br><br>
        <input id="user" placeholder="Usuario admin"><br>
        <input id="pass" type="password" placeholder="ContraseÃ±a"><br>
        <button class="btn-dark" onclick="login()">Acceder como Admin</button>
    </div>

    <!-- APP -->
    <div id="app" style="display:none;">

        <div class="box">
            <h2>Realizar PeticiÃ³n ðŸŽ¬</h2>
            <input id="nombre" placeholder="Nombre">
            <input id="anio" placeholder="AÃ±o">
            <select id="tipo">
                <option>Pelicula</option>
                <option>Serie</option>
            </select>

            <button class="btn-green" onclick="enviar()">Enviar PeticiÃ³n</button>
        </div>

        <div class="box">
            <h2>Peticiones Guardadas</h2>
            <div id="peticionesLista"></div>
        </div>

    </div>
</div>

<!-- ðŸ”¥ Firebase v8 (el necesario para que el cÃ³digo funcione sin build) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ==============================================================
// ðŸš€ Tu Firebase real ya insertado â†“
// ==============================================================

var firebaseConfig = {
  apiKey: "AIzaSyCkIbgaE-3JuVH0sq5TqGX_RMquI_9WWI4",
  authDomain: "bflix-ac765.firebaseapp.com",
  databaseURL: "https://bflix-ac765-default-rtdb.firebaseio.com",
  projectId: "bflix-ac765",
  storageBucket: "bflix-ac765.firebasestorage.app",
  messagingSenderId: "452307166004",
  appId: "1:452307166004:web:7427d9d40d1cabb6b47b61",
  measurementId: "G-P5PMP8H7ED"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ==============================================================
// SISTEMA DE LOGIN
// ==============================================================
let admin = false;

function abrirPanel(){ document.getElementById("panel").style.display = "block"; }
function invitado(){ admin=false; mostrarApp(); }

function login(){
    if(document.getElementById("user").value=="BflixTeam" &&
       document.getElementById("pass").value=="PassBflixMovian"){
        admin = true;
        mostrarApp();
    } else alert("Datos incorrectos");
}

function mostrarApp(){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("app").style.display="block";
}

// ==============================================================
// ðŸ“© GUARDAR PETICIÃ“N EN LA NUBE
// ==============================================================
function enviar(){
    let nombre = document.getElementById("nombre").value;
    let anio   = document.getElementById("anio").value;
    let tipo   = document.getElementById("tipo").value;

    if(!nombre||!anio) return alert("Completa ambos campos");

    db.ref("peticiones").push({
        nombre,anio,tipo,estado:"pendiente"
    });

    alert("âœ” Tu solicitud ha sido enviada");
}

// ==============================================================
// ðŸ”„ SINCRONIZACIÃ“N EN TIEMPO REAL
// ==============================================================
db.ref("peticiones").on("value",data=>{
    let html="";
    data.forEach(p=>{
        let v=p.val(),id=p.key;
        html+=`
        <div>
            ${v.nombre} (${v.anio}) [${v.tipo}]
            <span class="${v.estado=="pendiente"?"pendiente":"realizada"}">
                ${v.estado=="pendiente"?"ðŸš«PendienteðŸš«":"âœ” Realizado âœ”"}
            </span>
            ${admin?`<button onclick="marcar('${id}')">âœ“</button>`:""}
        </div>`;
    });
    document.getElementById("peticionesLista").innerHTML=html;
});

// ==============================================================
// ðŸŸ¢ Marcar como realizado (solo admin)
// ==============================================================
function marcar(id){
    db.ref("peticiones/"+id).update({estado:"realizado"});
}
</script>
</body>
</html>
